#!/usr/bin/env node
import {b,e,a,c,d}from'./chunk-54W34GRC.js';import {b as b$1}from'./chunk-5VUAD25I.js';export{a as MessageType,b as colorsMap}from'./chunk-5VUAD25I.js';import {execSync}from'child_process';import {resolve,dirname}from'path';import {EOL}from'os';import P from'fs';function g(e){try{return execSync(e,{encoding:"utf-8"}).split(EOL).filter(Boolean).map(r=>resolve(r))}catch{return []}}async function M(){let e=g("git diff --name-only"),o=g("git diff --cached --name-only"),r=g("git ls-files --others --exclude-standard"),t=g("git ls-files --deleted");return Array.from(new Set([...e,...o,...r,...t]))}function U(e,o=true){let r=e.errors.length?b$1.error:e.warnings.length?b$1.warning:void 0;o&&r&&c(r);for(let t of e.warnings)console.log(b$1.warning,t);for(let t of e.errors)console.log(b$1.error,t);e.errors.length>0&&process.exit(1);}function S(){let e=process.cwd(),o=resolve(e,"codefather.json"),r=resolve(e,"codefather.ts");return P.existsSync(r)?dirname(r):P.existsSync(o)?dirname(o):e}function F(e,o){return e?.length?e.some(({name:r,emailPrefix:t})=>o.name&&r===o.name||o.emailPrefix&&t===o.emailPrefix):false}function E(e,o,r){let{caporegimes:t=[],rules:s=[]}=r,l={errors:[],warnings:[]};if(F(t,o))return l;let b=S();for(let i of s){let h=d(e,i.match,b);if(h.length===0)continue;let u=i.goodfellas||[];if(i.crews&&r.crews){let p=i.crews.flatMap(w=>r.crews?.[w]).filter(Boolean);u.push(...p);}if(!F(u,o)){let p=i?.allowForgiveness?"warning":"error",y=`${i.message||a(p,{goodfellas:[...t,...u],commiters:[o]})}

 Unauthorized files:
${h.map(D=>`   - ${D}`).join(`
`)}`;i.allowForgiveness?l.warnings.push(y):l.errors.push(y);}}return l}function L(){try{let e$1=execSync("git config user.email",{encoding:"utf8"}),o=execSync("git config user.username",{encoding:"utf8"});if(!e$1&&!o)throw new Error;let r=e(e$1);return {name:o,emailPrefix:r}}catch{throw new Error(a("no-gitconfig"))}}function T(e,o,r,t){r&&c(o);let s=a(e,{commiters:[t]});console.log(o,s);}async function V(){try{let e=await b(),o=await M(),r=e.options?.showAscii??!0,t=L();if(o.length===0)return T("no-changes",b$1.info,r,t);let s=E(o,t,e);return s.errors.length===0&&s.warnings.length===0?T("success",b$1.success,r,t):U(s,r)}catch(e){return console.log(b$1.error,e instanceof Error?e.message:String(e))}}V();