#!/usr/bin/env node
'use strict';var chunkSUTBUN3F_cjs=require('./chunk-SUTBUN3F.cjs'),chunkQVAO4WBE_cjs=require('./chunk-QVAO4WBE.cjs'),child_process=require('child_process'),path=require('path'),os=require('os'),v=require('fs');function _interopDefault(e){return e&&e.__esModule?e:{default:e}}var v__default=/*#__PURE__*/_interopDefault(v);function m(e){try{return child_process.execSync(e,{encoding:"utf-8"}).split(os.EOL).filter(Boolean).map(r=>path.resolve(r))}catch{return []}}async function G(){let e=m("git diff --name-only"),o=m("git diff --cached --name-only"),r=m("git ls-files --others --exclude-standard"),t=m("git ls-files --deleted");return Array.from(new Set([...e,...o,...r,...t]))}function M(e,o=true){let r=e.errors.length?chunkQVAO4WBE_cjs.c.error:e.warnings.length?chunkQVAO4WBE_cjs.c.warning:void 0;o&&r&&chunkSUTBUN3F_cjs.c(r);for(let t of e.warnings)console.log(chunkQVAO4WBE_cjs.c.warning,t);for(let t of e.errors)console.log(chunkQVAO4WBE_cjs.c.error,t);e.errors.length>0&&process.exit(1);}function P(){let e=process.cwd(),o=path.resolve(e,"codefather.json"),r=path.resolve(e,"codefather.ts");return v__default.default.existsSync(r)?path.dirname(r):v__default.default.existsSync(o)?path.dirname(o):e}function S(e,o){return e?.length?e.some(({name:r,emailPrefix:t})=>o.name&&r===o.name||o.emailPrefix&&t===o.emailPrefix):false}function F(e,o,r){let{caporegimes:t=[],rules:s=[]}=r,f={errors:[],warnings:[]};if(S(t,o))return f;let V=P();for(let i of s){let d=chunkSUTBUN3F_cjs.d(e,i.match,V);if(d.length===0)continue;let g=i.goodfellas||[];if(i.crews&&r.crews){let u=i.crews.flatMap(h=>r.crews?.[h]).filter(Boolean);g.push(...u);}if(!S(g,o)){let u=i?.allowForgiveness?"warning":"error",w=`${i.message||chunkSUTBUN3F_cjs.a(u,{goodfellas:[...t,...g],commiters:[o]})}

 Unauthorized files:
${d.map(b=>`   - ${b}`).join(`
`)}`;i.allowForgiveness?f.warnings.push(w):f.errors.push(w);}}return f}function A(){try{let e=child_process.execSync("git config user.email",{encoding:"utf8"}),o=child_process.execSync("git config user.username",{encoding:"utf8"});if(!e&&!o)throw new Error;let r=chunkSUTBUN3F_cjs.e(e);return {name:o,emailPrefix:r}}catch{throw new Error(chunkSUTBUN3F_cjs.a("no-gitconfig"))}}function L(e,o,r,t){r&&chunkSUTBUN3F_cjs.c(o);let s=chunkSUTBUN3F_cjs.a(e,{commiters:[t]});console.log(o,s);}async function T(){try{let e=await chunkSUTBUN3F_cjs.b(),o=await G(),r=e.options?.showAscii??!0,t=A();if(o.length===0)return L("no-changes",chunkQVAO4WBE_cjs.c.info,r,t);let s=F(o,t,e);return s.errors.length===0&&s.warnings.length===0?L("success",chunkQVAO4WBE_cjs.c.success,r,t):M(s,r)}catch(e){return console.log(chunkQVAO4WBE_cjs.c.error,e instanceof Error?e.message:String(e))}}T();Object.defineProperty(exports,"MessageType",{enumerable:true,get:function(){return chunkQVAO4WBE_cjs.b}});Object.defineProperty(exports,"colorsMap",{enumerable:true,get:function(){return chunkQVAO4WBE_cjs.c}});